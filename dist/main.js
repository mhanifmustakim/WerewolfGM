(()=>{"use strict";const e={Citizens:{winCondition:"Eliminate all werewolves.",checkWinCondition:function(){return 0==t.findPlayersByAttr({type:"Werewolf",isAlive:!0}).length}},Werewolves:{winCondition:"Manipulate the citizens. You win when the No. Werewolves is equal to No. Humans",checkWinCondition:function(){return t.findPlayersByAttr({type:"Werewolf",isAlive:!0}).length>=t.findPlayersByAttr({type:"Human",isAlive:!0})}}},t=function(){let t=[],r=!1,n=1,i=null,o=null,a=null;const l=e=>t.filter((t=>t.id==e))[0],s=e=>{const r=[];return t.forEach((t=>{let n=!0;Object.entries(e).forEach((([e,r])=>{"excludeRole"==e?r==t.roleName&&(n=!1):t[e]!==r&&(n=!1)})),n&&r.push(t)})),r},c=()=>{Array.from(new Set(s({isAlive:!0}).map((e=>e.role.team)))).forEach((t=>{e[t].checkWinCondition()&&(i=t,r=!0)}))};return{get players(){return t},get isGameOver(){return r},get winner(){return i},setRoleQuantities:e=>{o=e},addPlayer:e=>{t.push(e)},findPlayersByAttr:s,addAction:(e,t)=>{a[e]=t},start:()=>{t.forEach((e=>e.reset())),(()=>{const e=[];Object.entries(o).forEach((([t,r])=>{for(let n=0;n<r;n++)e.push(t)})),t.forEach((t=>{const r=Math.floor(Math.random()*e.length),n=e.splice(r,1);t.setRole(n)}))})()},voteOut:e=>{l(e).die(),c()},reset:()=>{t=[],r=!1,n=1,i=null,o=null},startNight:()=>{a={}},endNight:()=>{const e=new Set,t=new Set;Object.values(a).forEach((r=>{Object.entries(r).forEach((([r,n])=>{switch(r){case"attacked":e.add(n);break;case"rescued":t.add(n)}}))})),Array.from(e).filter((e=>!t.has(e))).forEach((e=>l(e).die())),c()}}}(),r=({id:e,name:t,type:r,team:n,abilities:i,description:o})=>({get id(){return e},get name(){return t},get type(){return r},get abilities(){return i},get team(){return n},get description(){return o}}),n={citizen:function(){return r({name:"Citizen",type:"Human",team:"Citizens",abilities:null,description:["You are a normal citizen with no special abilities."]})},werewolf:function(){const e=r({name:"Werewolf",type:"Werewolf",team:"Werewolves",abilities:{attack:{isAlive:!0,type:"Human"}},description:["The werewolves choose one player to attack every night."]});return e.attack=r=>{return n=e.name,i=r,void t.addAction(n,{attacked:i});var n,i},e},doctor:function(){const e=r({name:"Doctor",type:"Human",team:"Citizens",abilities:{heal:{isAlive:!0,excludeRole:"Doctor"}},description:["The doctor chooses one player to heal every night (not himself). ","If that player is attacked, the player lives."]});return e.heal=r=>{return n=e.name,i=r,void t.addAction(n,{rescued:i});var n,i},e}},i=function(e){const t=i.getId();let r=!0,o=null,a=null,l=null;return{get name(){return e},get id(){return t},get role(){return o},get isAlive(){return r},get roleName(){return a},get type(){return l},setRole:e=>{o=n[e](),a=o.name,l=o.type},die:()=>{r=!1},reset:()=>{r=!0,o=null,a=null,l=null}}};i.nextId=1,i.getId=function(){const e=i.nextId;return i.nextId+=1,e};const o=i;(function(){const r=e=>{for(let r=0;r<e;r++){const e=o(`Player ${r}`);t.addPlayer(e)}},i=e=>e[Math.floor(Math.random()*e.length)],a=(e,o)=>{t.reset(),r(e),t.setRoleQuantities(o),t.start();const a=Array.from(new Set(Object.keys(o))).filter((e=>null!==n[e]().abilities)).sort();for(;!t.isGameOver;){const e=t.findPlayersByAttr({isAlive:!0}),r=i(e);if(t.voteOut(r.id),t.isGameOver)break;t.startNight(),a.forEach((e=>{const r=n[e]();t.findPlayersByAttr({roleName:r.name,isAlive:!0}).length>0&&Object.entries(r.abilities).forEach((([e,n])=>{const o=t.findPlayersByAttr(n),a=i(o);r[e](a.id)}))})),t.endNight()}return t.winner};return{roleDistributionTest:(e,i,o)=>{t.reset();const a=Array.from(new Set(Object.keys(i))).map((e=>n[e]().name));r(e);const l={};t.players.forEach((e=>{l[e.name]={},a.forEach((t=>{l[e.name][t]=0}))})),t.setRoleQuantities(i);for(let e=0;e<o;e++)t.start(),t.players.forEach((e=>l[e.name][e.roleName]+=1));t.players.forEach((e=>{a.forEach((t=>{l[e.name][t]/=o}))})),console.log(l)},cycleTest:a,nSimulations:(t,r,n)=>{const i=Array.from(Object.keys(e)),o={};i.forEach((e=>o[e]=0));for(let e=0;e<n;e++){const e=a(t,r);o[e]+=1}i.forEach((e=>o[e]/=n)),console.log(o)}}})().nSimulations(10,{citizen:6,werewolf:3,doctor:1},1e3)})();